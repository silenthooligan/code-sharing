# üìñ FlipHTML5 Liberator

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg) ![License](https://img.shields.io/badge/license-MIT-green.svg) ![Python](https://img.shields.io/badge/python-3.7%2B-blue.svg) ![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)

> **The Universal FlipHTML5 Downloader**. Break through "Protected" books, decode WASM encryption, and generate high-quality PDFs.

---

## üöÄ Why This Tool?

Typical downloaders fail when they encounter FlipHTML5's "Protected" mode or newer "Encrypted Config" books. These books hide their page structure inside obfuscated code or encrypted blobs that require a specific WebAssembly (WASM) binary to decode.

**FlipHTML5 Liberator** uses a **Hybrid Decoder Architecture** to bypass these restrictions. It runs a local Node.js environment patched with the original `deString.js` and `deString.wasm` binaries to essentially "trick" the configuration into revealing itself.

### ‚ú® Features

*   **üîì Decrypts "Protected" Books**: Handles books that lock down the UI and obscure source files.
*   **üß† WASM-Based Decoding**: seamless integration with the original `deString.wasm` binary for 100% accurate decryption.
*   **üï∏Ô∏è Nested Encryption Handling**: Detects and recursively decodes page lists hidden inside *double-encrypted* strings.
*   **üîó Hashed Path Resolution**: Solves the puzzle of non-sequential, hashed image filenames (e.g., `afbd9e...webp`).
*   **üñºÔ∏è High-Fidelity Output**: Downloads the highest resolution (`/files/large/`) images available.
*   **üìÑ PDF Generation**: Automatically combines downloaded pages into a single `book.pdf`.

---

## üõ†Ô∏è Installation

### Prerequisites

1.  **Python 3.7+**: [Download Python](https://www.python.org/)
2.  **Node.js**: [Download Node.js](https://nodejs.org/) (Required for the decryption engine)
3.  **WASM Binaries**: You will need to "borrow" `deString.js` and `deString.wasm` from the target book (instructions below).

### Getting Started

1.  **Clone the Repo** (or download the scripts):
    ```bash
    git clone https://github.com/silenthooligan/fliphtml5-liberator.git
    cd fliphtml5-liberator
    ```

2.  **Install Python Dependencies**:
    ```bash
    pip install httpx img2pdf Pillow
    ```

---

## üìñ Usage

### 1. Acquire the Keys üîë
To decode the book, you need the "key" (the WASM files).

1.  Open the target FlipHTML5 book in your web browser.
2.  Open **Developer Tools** (F12 or Right Click -> Inspect).
3.  Go to the **Network** tab.
4.  Refresh the page.
5.  Filter for `deString`.
6.  Right-click and **Download/Save** both `deString.js` and `deString.wasm`.
7.  Place them in the root folder of this project.

### 2. Run the Liberator ‚ö°
Run the python script with the URL of the book you want to download.

```bash
python downloader.py https://online.fliphtml5.com/ousx/stby
```

**What happens next:**
1.  The script fetches the obfuscated `config.js` from the server.
2.  It launches `fliphtml5_decoder.js` in a subprocess.
3.  The Node.js script patches the `deString` loader, injects polyfills, and runs the WASM decryption.
4.  The decrypted JSON is piped back to Python.
5.  Images are downloaded concurrently.
6.  **`book.pdf`** is generated!

---

## üßê How It Works (The Technical Part)

This tool solves the "black box" problem of WASM obfuscation by implementing a **Host Environment Polyfill**.

1.  **Emscripten Patching**: The original `deString.js` is generated by Emscripten and relies on browser-specific globals (`window`, `Module.onRuntimeInitialized`). We patch these out regex-style to run in a headless Node.js environment.
2.  **Memory Management**: We manually implement `stringToUTF8` and `UTF8ToString` to bridge the gap between JavaScript strings and the WASM heap, as the original exports are often stripped or mangled.
3.  **Recursive Decryption**: Some books use layers of encryption. The script detects if the decoded output contains *another* encrypted block (starting with signature `v...`) and recursively passes it back through the WASM decoder.

---

## ‚ö†Ô∏è Disclaimer

This tool is for **educational and archival purposes only**. Please respect copyright laws and the terms of service of the content providers. Do not use this tool to distribute copyrighted material without permission.

---

**Happy Reading!** üìö
